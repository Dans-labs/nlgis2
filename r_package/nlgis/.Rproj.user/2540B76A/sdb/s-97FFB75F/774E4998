{
    "contents" : "---\ntitle: \"R basic analysis\"\nauthor: \"Richard Zijdeman & Auke Rijpma\"\ndate: \"14 Nov 2014\"\noutput:\n  beamer_presentation:\n    #colortheme: dolphin\n    fonttheme: structurebold\n    theme: Warsaw\n    toc: true\n    # slide_level: 2\n    keep_tex: true # keeps tex file\n    highlight: espresso # highlighting of syntax\n---\n\n# Basic analyses in R\n## Data management tips\n- create a new directory for each project you run\n- make the project independent (all files in that dir)\n- make comments (all the time!)\n- make a logbook of your files (bigger project)\n- make sure you have a backup\n\n## Cleaning data\n- always check all variables for inconsistencies\n    - 'wrong' type\n    - 'wrong' values\n- never(!) change an original variable\n    - copy it and change the copy\n    - quite some work, but still time efficient\n\n## About the data we will use\n- real data !!! (real data == real issues) \n- \"Nieuwkomers in de Utrechtse bevolking\" by Jelle van Lottum\n- Census data of the city of Utrecht in 1829 (and 1839)\n- all foreign born inhabitants of Utrecht\n- socio-economic variables (name, age, occupation)\n- geographic variables (street, neighborhood, place of birth)\n- http://bit.ly/1xCzIoA (is included in materials)\n\n## Reading in the data\n- original file is .xls:\n    - use read.xls from gdata (macosx, linux and windows with perl)\n    - or go for the .xlsx file with read.xlsx or the .csv\n    \n```{r, results = 'hide' }\n# http://www.r-bloggers.com/read-excel-files-from-r/\nlibrary(gdata)\nsetwd(\"/Users/richard/Dropbox/rcursus/wog_intro_r/\")\n```\n----\n```{r}\nu29.url <- \n   paste0(\"http://socialhistory.org/sites/default/\",\n          \"files/docs/utrecht1829.xls\")\n u29 <- read.xls(u29.url, na.strings = c(\"~\", \"NA\"))\n # u29 <- read.csv(\"./data/derived/utrecht1829.csv\")\n```\n----\n```{r}\n# using .csv (uncomment lines below)\n# setwd(\"/Users/richard/Dropbox/rcursus/wog_intro_r/\") \n# u29 <- read.csv(\"./data/derived/utrecht1829.csv\")\n```\n\n## Cleaning: remove columns\n- Was data read in properly?\n    - removing empty columns\n    - indexing is one way, but it is safer to use names\n    - in the future consider the data.table package \n```{r}\ndim(u29)\nu29.1 <- subset(u29, select = \n                  -(grep(\"X\", names(u29)))) \ndim(u29.1)\n```\n\n## Cleaning: errors in data\n- Comparatively really well documented data\n- But: > \"De meeste velden van de database wijzen voor zichzelf, [...].\"\n- What values for gender would you expect?\n```{r, results = \"hide\"}\ntable(u29.1$geslacht, useNA = \"ifany\")\n```\n\n## Cleaning: errors in data 2\n```{r}\ntable(u29.1$geslacht, useNA = \"ifany\")\n```\n\n## Cleaning: errors in data 3\n- So we need to clean this variable\n- As \"geslacht\" is a factor variable:\n    - clean values\n    - clean levels\n```{r}\nu29.1$geslacht.cln <- NA\nu29.1$geslacht.cln <- u29.1$geslacht\nu29.1$geslacht.cln[u29.1$geslacht == \"mulder\"] <- \"v\" \n# name = \"sophia\"\n```\n\n```{r, echo = FALSE, results = \"hide\"}\nu29.1$geslacht.cln[u29.1$geslacht == \"b\" ] <- \"v\" # qwerty-keyboard coding error\nu29.1$geslacht.cln[u29.1$geslacht == \"m \"] <- \"m\" # coding error\nu29.1$geslacht.cln[u29.1$geslacht == \"n\" & u29.1$voornaam ==\"christoffel\"] <- \"m\"\nu29.1$geslacht.cln[u29.1$geslacht == \"n\" & u29.1$voornaam ==\"hendrik\"    ] <- \"m\"\nu29.1$geslacht.cln[u29.1$geslacht == \"n\" & u29.1$voornaam ==\"roselia\"    ] <- \"v\"\nu29.1$geslacht.cln[u29.1$geslacht == \"n\" & u29.1$voornaam ==\"joh.  \"     ] <- NA\nu29.1$geslacht.cln[u29.1$geslacht == \"n\" & u29.1$voornaam ==\"marie a.\"   ] <- \"v\"\nu29.1$geslacht.cln[u29.1$geslacht == \"o\"] <- \"v\"\nu29.1$geslacht.cln[u29.1$geslacht == \"w\" & u29.1$voornaam ==\"mijntje\" ] <- \"v\"\nu29.1$geslacht.cln[u29.1$geslacht == \"w\" & u29.1$voornaam ==\"maria t.\"] <- \"v\"\nu29.1$geslacht.cln[u29.1$geslacht == \"w\" & u29.1$voornaam ==\"anna m.\" ] <- \"v\"\ntable(u29.1$geslacht.cln, useNA = \"ifany\")\n```\n## Cleaning: errors in data 4\n\n\n```{r}\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) \n                         == \"mulder\" ] <- NA\n```\n\n```{r, echo=FALSE, results = \"hide\"}\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) == \"b\" ] <- NA\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) == \"m \"] <- NA\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) == \"n\" ] <- NA\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) == \"o\" ] <- NA\nlevels(u29.1$geslacht.cln)[levels(u29.1$geslacht.cln) == \"w\" ] <- NA\ntable(u29.1$geslacht.cln)\n```\n\n\n\n## The distribution of age of heads of households\n```{r, echo = FALSE, results = \"hide\"}\n# making a selection of the data (heads of household)\n# note that the \"?\" in the var-name was replaced:\n# names(u29)\ntable(u29.1$hoofdbewoner., useNA = \"ifany\") # note wrong codes here too\nu29.1$hoofdbewoner.cln <- NA\nu29.1$hoofdbewoner.cln <- u29.1$hoofdbewoner.\n\nu29.1$hoofdbewoner.cln[u29.1$hoofdbewoner. == \"b\"  ] <- \"n\" #already other hhead\nu29.1$hoofdbewoner.cln[u29.1$hoofdbewoner. == \"n \" ] <- \"n\"\ntable(u29.1$hoofdbewoner.cln, useNA = \"ifany\")\n```\n\n```{r}\nu29.1h <- subset(u29.1, hoofdbewoner.cln == \"j\")\ndim(u29.1h) # 421 cases\n```\n\n## Box and whisker plot\n- Distribution of data\n- Median: 50% of the cases above and below\n- Box: 1st and 3rd quartile\n- Interquartile range (IQR): Q3-Q1\n- Outliers (Tukey, 1977): \n    - x < Q1 - 1.5*IQR \n    - x > Q3 + 1.5*IQR \n\n----\n\n```{r}\nboxplot(u29.1h$leeftijd, \n        ylab = \"Age\")\n# boxplot(leeftijd, data = u29.1) # doesn't work!\n```\n\n----\n\n```{r}\nboxplot(leeftijd ~ geslacht.cln, data = u29.1h,\n        xlab = \"Sex\", ylab = \"Age\")\n```\n\n---- \n\n```{r}\nboxplot(leeftijd ~ geslacht.cln, data = u29.1h,\n        names = c(\"male\", \"female\"),\n        col = \"lightgrey\") \n```\n\n----\n\n```{r}\nboxplot(leeftijd ~ geslacht.cln, data = u29.1h,\n        names = c(\"male\", \"female\"),\n        col = c(\"lightblue\", \"pink\")) \n```\n\n## T-test: \n- difference in mean of two groups?\n- are female heads of household older than male heads of household?\n- Let's first look at the means, using aggregate()\n\n```{r}\naggregate(leeftijd ~ geslacht.cln, data = u29.1h, \n          FUN = mean)\n```\n\n## Equal variances?\n- we'll use the Levene test from the car(package)\n```{r}\nlibrary(car)\n```\n\n----\n\n```{r}\nleveneTest(leeftijd ~ geslacht.cln, data = u29.1h,\n           center = mean) # NB: center = median by default\n```\nSo, no significant difference in variance, so we test with equal variance\n\n## Testing for differences in age between \n```{r}\nt.test(leeftijd ~ geslacht.cln, var.equal = TRUE, \n      alternative = \"two.sided\", data = u29.1h)\n```\n\n----\n\n>So, there is no significant difference in age between male and female heads of household, born abroad\n\n----\n\n## Frequency tables\n- Are non-native Dutch geograpically segregated by religion?\n- Info on steets and houses, but we'll stick to neighbourhoods (\"wijken\")\n- First: clean religion-variable (new variable religie2)\n```{r, echo = FALSE, results = \"hide\"}\nu29.1h$religie2 <- NA # create new variable\nu29.1h$religie2 <- u29.1h$religie # copy old values\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"cle\"] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"dg\" ] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"epi\"] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"g\"  ] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"pre\"] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"wg\" ] <- \"anders\"\nlevels(u29.1h$religie2)[levels(u29.1h$religie2) == \"isr\"] <- \"anders\"\n```\n\n```{r}\ntable(u29.1h$religie2)\n```\n\n----\n\n- Crosstable of neighbourhood and religion\n```{r}\ntable(u29.1h$religie2, u29.1h$wijknummer, \n      useNA = \"ifany\")\n```\n\n----\n\n- combine neighbourhoods into: center and non-center \n- defining 'neighbourhoods' (\"wijknummer\") in city center\n```{r, echo= FALSE, results='hide'}\ncenter <- c(\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\")\n\nu29.1h$city.center <- NA\nu29.1h$city.center[u29.1h$wijknummer %in% center] <- 1\nu29.1h$city.center[!(u29.1h$wijknummer %in% center) & \n                       !is.na(u29.1h$wijknummer)] <- 0\n# so 0 if not a,b,c,d...,h and not missing\n```\n\n```{r}\ntable(u29.1h$city.center, useNA = \"ifany\")\n```\n353 in city center and 68 not, so most are living in city center\n\n\n-----\n\nNow, we can study the segregation by religion\n```{r}\nseg.table <- table(as.factor(u29.1h$city.center), \n                   u29.1h$religie2)\nseg.table\n```\n\n----\n\n```{r}\nround(prop.table(seg.table,2),3) # 2 for column-wise\nchisq.test(seg.table)\n```\n\n----\n\nSmall cell values, therefore running doing Fisher's exact test\n\n```{r}\nfisher.test(seg.table) # somewhat bigger p value, but still p <.5\n```\n\nThe p-value is somewhat bigger, but still p < .5\n\n----\n\n```{r}\nlibrary(vcd)\nassocstats(seg.table) \n```\n- Cramer's V: .155 small to medium effect (.07 / .21)\n\n",
    "created" : 1417504562437.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3775814828",
    "id" : "774E4998",
    "lastKnownWriteTime" : 1415980775,
    "path" : "~/Dropbox/rcursus/published/rcode/richard/rcourse/basic_analyses/r_basic_analyses02.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}